{"version":3,"sources":["webpack:///./src/common/onMessage.js?985f"],"names":["registerMessage","messageHandlers","handlers","doListener","msg","sender","response","responseFn","responseMsg","call","push","event","process","Error","isRegister","chrome","runtime","onMessage","addListener","e","console","log"],"mappings":";;;;;;;;;;SA2BgBA,e,GAAAA,e;;AA1BhB;;AAEA,KAAMC,kBAAkB;AACtBC,aAAU,EADY;AAEtBC,aAFsB,sBAEXC,GAFW,EAENC,MAFM,EAEEC,QAFF,EAEY;AAChC,oBAAK,aAAL,EAAoBF,GAApB;AACA,SAAMG,aAAa,SAAbA,UAAa,CAACC,WAAD,EAAiB;AAClC,sBAAK,iBAAL,EAAwBA,WAAxB;AACAF,gBAASE,WAAT;AACD,MAHD;AAIA,UAAKN,QAAL,CAAcE,GAAd,EAAmBK,IAAnB,CAAwB,IAAxB,EAA8BL,GAA9B,EAAmCC,MAAnC,EAA2CE,UAA3C;AACD,IATqB;AAUtBG,OAVsB,gBAUjBC,KAViB,EAUVC,OAVU,EAUD;AACnB,SAAI,KAAKV,QAAL,CAAcS,KAAd,CAAJ,EAA0B;AACxB,aAAME,mCAAaF,KAAb,kBAAN;AACD;AACD,SAAI,CAACC,OAAD,IAAY,OAAOA,OAAP,KAAmB,UAAnC,EAA+C;AAC7C,aAAMC,uBAAWF,KAAX,sDAAN;AACD;;AAED,UAAKT,QAAL,CAAcS,KAAd,IAAuBC,OAAvB;AACD;AAnBqB,EAAxB;;AAsBA,KAAIE,aAAa,KAAjB;;AAEO,UAASd,eAAT,CAAyBW,KAAzB,EAAgCC,OAAhC,EAAyC;AAC9CX,mBAAgBS,IAAhB,CAAqBC,KAArB,EAA4BC,OAA5B;AACE,OAAI,CAACE,UAAL,EAAiB;AACb,SAAG;AACCC,cAAOC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CAAqC,UAACd,GAAD,EAAMC,MAAN,EAAcC,QAAd,EAA2B;AAC5DL,yBAAgBE,UAAhB,CAA2BC,GAA3B,EAAgCC,MAAhC,EAAwCC,QAAxC;AACH,QAFD;AAGAQ,oBAAa,IAAb;AACH,MALD,CAKE,OAAMK,CAAN,EAAS;AACPC,eAAQC,GAAR,CAAY,wEAAZ;AACAD,eAAQC,GAAR,CAAYF,CAAZ;AACH;AACJ;AACJ,E","file":"0.35893ba4cf8ff56a00a2.hot-update.js","sourcesContent":["\nimport { info } from './log';\n\nconst messageHandlers = {\n  handlers: {},\n  doListener(msg, sender, response) {\n    info('[onMessage]', msg);\n    const responseFn = (responseMsg) => {\n      info('[onMessageBack]', responseMsg);\n      response(responseMsg);\n    };\n    this.handlers[msg].call(this, msg, sender, responseFn);\n  },\n  push(event, process) {\n    if (this.handlers[event]) {\n      throw Error(`重复监听${event}事件`);\n    }\n    if (!process || typeof process !== 'function') {\n      throw Error(`监听${event}必须传入回调函数`);\n    }\n\n    this.handlers[event] = process;\n  }\n};\n\nlet isRegister = false;\n\nexport function registerMessage(event, process) {\n  messageHandlers.push(event, process);\n    if (!isRegister) {\n        try{\n            chrome.runtime.onMessage.addListener((msg, sender, response) => {\n                messageHandlers.doListener(msg, sender, response);\n            });\n            isRegister = true;  \n        } catch(e) {\n            console.log('onMessage error: the reason maybe hot reload while open background tab')\n            console.log(e)\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/common/onMessage.js"],"sourceRoot":""}